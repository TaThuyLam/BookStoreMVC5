@model WebsiteBanSach.Models.DonHang

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Layout/AdminLayout.cshtml";
}
<style>
    body{
    }
    .form {
        background-color: white;
        padding: 10px;
        margin-bottom: 10px;
        
    }

    .grid {
        background-color: white;
        display: grid;
        grid-template-columns: auto auto auto auto;
        margin-bottom: 10px
    }

    .grid-item {
        height: 50px;
        margin: 10px
    }

    .lable {
        font-size: 15px;
        color: dimgrey;
        margin: 0
    }

    .text {
        font-size: 20px;
        font-weight: bold;
        margin: 0
    }

    input {
        border: 0 solid;
        background-color: white;
    }

    .btn_delete {
        display: none;
    }

    .btn-danger, .btn-info, .btn-success {
        width: 200px;
        margin: 10px;
        color: white;
        box-shadow: inherit;
    }
    .btn_action {
       height:50px;
       text-align:right;

    }
    .btn_reset,.btn_save{
        width:100px;
        color:white;
        margin:10px;
        display:none;

    }
        .btn_reset{
            background-color:red;
            
        }
        .btn_save{
            background-color:blue;
        }
  
</style>
<body onload="load()">
    <div class="form">
        <h5 class="text">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar2-check" viewBox="0 0 16 16">
                <path d="M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z" />
                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z" />
                <path d="M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z" />
            </svg>  Thông tin đơn hàng
        </h5>
        <hr />
        <div class="grid">
            <div class="grid-item">
                <p class="lable">ID</p>
                <p class="text">@Model.MaDonHang</p>
            </div>
            <div class="grid-item">
                <p class="lable">Date</p>
                <p class="text">@Model.NgayDat</p>
            </div>
            <div class="grid-item">
                <p class="lable">Tình trạng đơn hàng</p>
                @if (Model.TinhTrangGiaoHang == 0)
                {

                    <p style="color: #336600 ">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" fill="#336600" class="bi bi-circle-fill" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>   Đang soạn đơn
                    </p>
                }
                else if (Model.TinhTrangGiaoHang == 1)
                {

                    <p style="color:green">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" fill="green" class="bi bi-circle-fill" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>   Đang giao hàng
                    </p>
                }
                else if (Model.TinhTrangGiaoHang == -1)
                {

                    <p style="color: #FF6699">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" fill="#FF6699" class="bi bi-circle-fill" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>  Chờ hủy đơn
                    </p>
                }
                else if (Model.TinhTrangGiaoHang == -2)
                {

                    <p style="color:red">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" fill="red" class="bi bi-circle-fill" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg>  Đã hủy
                    </p>
                }
                else if (Model.TinhTrangGiaoHang == 3)
                {

                    <p style="color:red">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="8" fill="red" class="bi bi-circle-fill" viewBox="0 0 16 16">
                            <circle cx="8" cy="8" r="8" />
                        </svg> Đã hoàn thành
                    </p>
                }
            </div>
            <div class="grid-item">
                <p class="lable">Type user</p>
                <p class="text">@Model.LoaiKH</p>
            </div>

        </div>

    </div>


    <div class="form">
        <h5 class="text">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-lines-fill" viewBox="0 0 16 16">
                <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5zm.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2z" />
            </svg>  Thông tin khách hàng
        </h5>
        <hr />
        <div class="grid">
            <div class="grid-item">
                <p class="text">Name</p>
                <p class="lable">@Model.TenKH</p>
            </div>
            <div class="grid-item">
                <p class="text">Address</p>
                <p class="lable">@Model.DiaChi</p>
            </div>
            <div class="grid-item">
                <p class="text">Phone</p>
                <p class="lable">@Model.SoDienThoai</p>
            </div>
        </div>

    </div>
    <div class="form">
        <h5 class="text">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list-columns-reverse" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M0 .5A.5.5 0 0 1 .5 0h2a.5.5 0 0 1 0 1h-2A.5.5 0 0 1 0 .5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10A.5.5 0 0 1 4 .5Zm-4 2A.5.5 0 0 1 .5 2h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 4h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 6h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2A.5.5 0 0 1 .5 8h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 0 1h-8a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1h-10a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5Zm-4 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5Zm4 0a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5Z" />
            </svg> Danh sách sản phẩm
            <i style="float:right;display:inline" onclick="EditOrderList()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
                    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                </svg>
            </i>
        </h5>


        <hr />
        <div class="container mt-3" style="text-align:center">
            <table class="table table-sm" id="table">
                <thead>
                    <tr class="background-white">
                        <th>#</th>
                        <th colspan="2">Sản phẩm</th>
                        <th>Số Lượng</th>
                        <th>Đơn giá</th>
                        <th>Thành tiền</th>

                    </tr>
                </thead>
                <tbody class="cart-item">
                    @{
                        int stt = 0;
                    }

                    @foreach (var item in Model.ChiTietDonHangs)
                    {
                        <tr class="cart-rows background-white">
                            @{stt++; }
                            <td>@stt.ToString()</td>
                            <td>
                                <img src="@Url.Content("~/ImgProducts/"+item.Sach.AnhBia)" height="70" />
                            </td>
                            <td>
                                <span class="anh"> @string.Format("{0:0,0}", @item.Sach.TenSach)</span>
                            </td>
                            <td style="text-align:center" name="soluong">
                                @using (Html.BeginForm("CapNhapDonHang", "Order", new { @MaSP = item.MaSach, @SoLuong = item.SoLuong, @MaDH = item.MaDonHang }))
                                {
                                    <input disabled type="number" name="txtSoLuong" min="1" value="@item.SoLuong" style="width:20%;text-align:center;" />
                                }
                            </td>

                            <td>
                                <span class="dongia"> @string.Format("{0:0,0}", @item.DonGia)</span> đ
                            </td>
                            <td>
                                @{
                                    int thanhtien = Convert.ToInt32(item.DonGia) * Convert.ToInt32(item.SoLuong);
                                }
                                <span class="thanhtien"> @thanhtien</span> đ
                            </td>
                            <td class="btn_delete" onclick="Delete_SP(@stt)">
                                <p>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-x-circle-fill" viewBox="0 0 16 16">
                                        <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z" />
                                    </svg>
                                </p>

                            </td>

                        </tr>

                    }

                </tbody>

            </table>
            <div class="btn_action">
                <button type="button" class="btn btn_reset">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-counterclockwise" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 3a5 5 0 1 1-4.546 2.914.5.5 0 0 0-.908-.417A6 6 0 1 0 8 2v1z" />
                        <path d="M8 4.466V.534a.25.25 0 0 0-.41-.192L5.23 2.308a.25.25 0 0 0 0 .384l2.36 1.966A.25.25 0 0 0 8 4.466z" />
                    </svg>
                    Reset
                </button>
                <button type="button" class="btn btn_save">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-download" viewBox="0 0 16 16">
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                        <path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z" />
                    </svg>
                    Save
                </button>
            </div>


        </div>

    </div>
    <div style="display:inline;margin-left:400px">
        <button type="button" class="btn btn-info">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-return-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M14.5 1.5a.5.5 0 0 1 .5.5v4.8a2.5 2.5 0 0 1-2.5 2.5H2.707l3.347 3.346a.5.5 0 0 1-.708.708l-4.2-4.2a.5.5 0 0 1 0-.708l4-4a.5.5 0 1 1 .708.708L2.707 8.3H12.5A1.5 1.5 0 0 0 14 6.8V2a.5.5 0 0 1 .5-.5z" />
            </svg>    Back
        </button>
        <button type="button" class="btn btn-danger">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z" />
                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z" />
            </svg>
            Cancel Order
        </button>
        <button type="button" class="btn btn-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check2" viewBox="0 0 16 16">
                <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" />
            </svg> Finish
        </button>
    </div>
   
        @if (TempData["message"] != null)
        {
            <script> 
                var alert_success = document.getElementsByClassName("alert-success")[0];
                alert_success.style = "display:flex";
                setTimeout(function () {
                    alert_success.style = "display:none";

                }, 3000);
    </script>
        }



</body>

<script>
    var table = document.getElementById("table");
    var tr = table.getElementsByTagName("tr");
    var input = document.getElementsByTagName("input");
    var btn_delete = document.getElementsByClassName("btn_delete");
    var btn_reset = document.getElementsByClassName("btn_reset")[0];
    var btn_save = document.getElementsByClassName("btn_save")[0];
    var btn_back = document.getElementsByClassName("btn-info")[0];
    var btn_cancel = document.getElementsByClassName("btn-danger")[0];
    var btn_finish = document.getElementsByClassName("btn-success")[0];




    function load() {
        if (@Model.TinhTrangGiaoHang == 0) {
            btn_finish.innerHTML = "Prepared";
             btn_finish.addEventListener("click", function () {
                 return location.href = '@Url.Action("PreparedOrder", new {id=Model.MaDonHang})';
             });
        }
        if (@Model.TinhTrangGiaoHang== 1) {
            btn_finish.innerHTML = "Finished";
             btn_finish.addEventListener("click", function () {
                 return location.href = '@Url.Action("FinishOrder",new {id=Model.MaDonHang})';
             });
        }
        if (@Model.TinhTrangGiaoHang == -2||@Model.TinhTrangGiaoHang==3) {
            btn_finish.disabled = true;
            btn_cancel.disabled = true;
        }
    }
    function EditOrderList() {
        for (i = 0; i < tr.length; i++) {
            input[i].style = "border:1px black solid;width:45px";
            input[i].disabled = false;
            btn_delete[i].style = "display:inline";
            btn_reset.style = "display:inline";
            btn_save.style = "display:inline";
        }

    }
    function Delete_SP(row) {
        table.deleteRow(row);
    }
    btn_save.addEventListener("click", function () {
        var td;
        window.location.reload();

    });
    btn_reset.addEventListener("click", function () {
        window.location.reload();
        EditOrderList();
    });

    //3 btn action

    btn_back.addEventListener("click", function () {
        return location.href='@Url.Action("Index")';
    });
    btn_cancel.addEventListener("click", function () {
        if (confirm('Are you sure want to delete this order?') == true) {
            return  location.href='@Url.Action("CancelOrder",new {id=Model.MaDonHang})';
        }
    });

    function ShowSuccess() {
        var alert_success = document.getElementsByClassName("alert-success")[0];
        alert_success.style = "display:flex";
        setTimeout(function () {
            alert_success.style = "display:none";

        }, 3000);
    }
    function ShowUnSuccess() {
        var alert_unsuccess = document.getElementsByClassName("alert-unsuccess")[0];
        alert_unsuccess.style = "display:flex";
        setTimeout(function () {
            alert_unsuccess.style = "display:none";

        }, 3000);
    }
</script>
